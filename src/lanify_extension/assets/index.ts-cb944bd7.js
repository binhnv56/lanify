const c="lanify:auth",o="lanify:popup",u="lanify:unlocked";function r(e,a){return console.log(e,JSON.stringify(a)),new Promise((t,n)=>{chrome.storage.local.set({[e]:JSON.stringify(a)}).then(()=>{t()}).catch(n)})}const l=e=>{try{return JSON.parse(e)}catch{return e}};function g(e){return new Promise((a,t)=>{chrome.storage.local.get([e]).then(n=>{a(l(n[e]))}).catch(t)})}chrome.runtime.onMessage.addListener(async(e,a,t)=>{console.log(e),t({msg:"received"})});chrome.runtime.onMessageExternal.addListener(async(e,a,t)=>{const{type:n,payload:s}=e;if(n)switch(n){case"getAuth":const i=await g(c);t(i);return;case"setAuth":await r(c,s);return;case"reconnect":return;case"clearStorage":await r(u,!1),await r(c,void 0),t("Storage has been cleared");return;default:return}t("NULL request")});chrome.runtime.onConnect.addListener(async e=>{e.name==="popup"&&(await r(o,!0),e.onDisconnect.addListener(async()=>{await r(o,!1)}))});
